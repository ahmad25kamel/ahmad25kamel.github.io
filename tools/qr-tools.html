<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Tools - Private Online Tools</title>
    <meta name="description" content="Generate QR codes from text or decode QR codes from images. 100% client-side, no uploads required.">
    <meta name="keywords" content="QR code generator, QR code scanner, barcode generator, QR code reader, QR code maker, free QR generator, online QR tool, privacy QR code, client-side QR generator, no upload QR code">
    <link rel="icon" type="image/png" href="../assets/img/favicon.png">
    
    <!-- Local CSS -->
    <link rel="stylesheet" href="../assets/css/minimal-tailwind.css">
    
    <!-- i18n Support -->
    <script src="../assets/js/i18n.js"></script>
    
    <!-- Local QR Code libraries -->
    <script src="../assets/js/vendor/qrcode-proven.js"></script>
    <script src="../assets/js/vendor/qr-reader-simple.js"></script>
    
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .drop-zone {
            border: 2px dashed #cbd5e0;
            transition: border-color 0.3s ease;
        }
        .drop-zone.dragover {
            border-color: #6366f1;
            background-color: #eef2ff;
        }
        
        /* Breadcrumb styling */
        .breadcrumb-container {
            font-size: 0.875rem;
        }
        .breadcrumb-link {
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: color 0.2s ease;
        }
        .breadcrumb-link:hover {
            color: white;
        }
        .breadcrumb-separator {
            margin: 0 8px;
            opacity: 0.6;
        }
        .breadcrumb-current {
            color: white;
            font-weight: 500;
        }
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            color: white;
        }
        .qr-preview {
            max-width: 250px;
            margin: 0 auto;
        }
        
        /* Notification styles */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
        }
        
        .notification {
            background: white;
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-left: 4px solid;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success { border-left-color: #10b981; }
        .notification.error { border-left-color: #ef4444; }
        .notification.warning { border-left-color: #f59e0b; }
        .notification.info { border-left-color: #3b82f6; }
        
        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
        }
        
        .notification-message {
            font-size: 14px;
            line-height: 1.4;
        }
        
        .notification.success .notification-title { color: #059669; }
        .notification.error .notification-title { color: #dc2626; }
        .notification.warning .notification-title { color: #d97706; }
        .notification.info .notification-title { color: #2563eb; }
        
        .notification.success .notification-message { color: #047857; }
        .notification.error .notification-message { color: #991b1b; }
        .notification.warning .notification-message { color: #92400e; }
        .notification.info .notification-message { color: #1d4ed8; }
        
        /* Loading animation */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="gradient-bg text-white py-4">
        <div class="container mx-auto px-4">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold">QR Code Tools</h1>
                    <p class="text-sm md:text-base opacity-90">Generate and decode QR codes</p>
                </div>
                <div class="navigation-wrapper">
                    <!-- Breadcrumb container for dynamic breadcrumbs -->
                    <div class="breadcrumb-container text-sm opacity-75 mb-2"></div>
                    <a href="/" class="back-to-tools-btn bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded transition-colors">
                        ‚Üê Back to Tools
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- Notification Container -->
    <div id="notificationContainer" class="notification-container"></div>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Tab Navigation -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <div class="flex flex-col md:flex-row gap-4 mb-6">
                <button id="generateTab" class="tab-button active flex-1 py-3 px-6 rounded-lg font-medium transition-colors">
                    üèóÔ∏è Generate QR Code
                </button>
                <button id="readTab" class="tab-button flex-1 py-3 px-6 rounded-lg font-medium bg-gray-100 hover:bg-gray-200 transition-colors">
                    üîç Read QR Code
                </button>
            </div>
        </div>

        <!-- Generate QR Code Section -->
        <div id="generateSection" class="space-y-8">
            <!-- Input Section -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Generate QR Code</h2>
                
                <!-- Text Input -->
                <div class="mb-6">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Enter text, URL, or data</label>
                    <textarea id="qrText" placeholder="Enter your text, URL, email, phone number, or any other data..." 
                              class="w-full h-32 p-3 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-vertical"></textarea>
                    <p class="text-sm text-gray-500 mt-1">Maximum recommended: 2000 characters</p>
                </div>

                <!-- QR Code Options -->
                <div class="mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-medium text-gray-700">QR Code Settings</h3>
                        <button id="toggleAdvanced" class="text-sm text-indigo-700 hover:text-indigo-800 focus:outline-none font-medium">
                            ‚öôÔ∏è Advanced Settings
                        </button>
                    </div>
                    
                    <!-- Basic Settings (always visible) -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Size</label>
                            <select id="qrSize" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="200" selected>Small (200√ó200)</option>
                                <option value="300">Medium (300√ó300)</option>
                                <option value="400">Large (400√ó400)</option>
                                <option value="500">Extra Large (500√ó500)</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Format</label>
                            <select id="qrFormat" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <option value="png">PNG</option>
                                <option value="svg">SVG (Vector)</option>
                            </select>
                        </div>
                    </div>

                    <!-- Advanced Settings (initially hidden) -->
                    <div id="advancedSettings" class="hidden">
                        <div class="border-t pt-4">
                            <div class="grid grid-cols-1 gap-4 mb-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Error Correction Level</label>
                                    <select id="errorCorrection" class="w-full p-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                        <option value="L">Low (7%)</option>
                                        <option value="M" selected>Medium (15%)</option>
                                        <option value="Q">Quartile (25%)</option>
                                        <option value="H">High (30%)</option>
                                    </select>
                                    <p class="text-xs text-gray-500 mt-1">Higher levels allow more damage but reduce data capacity</p>
                                </div>
                            </div>

                            <!-- Color Options -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Foreground Color</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="color" id="foregroundColor" value="#000000" class="w-12 h-10 border border-gray-300 rounded">
                                        <input type="text" id="foregroundColorText" value="#000000" class="flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    </div>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Background Color</label>
                                    <div class="flex items-center space-x-2">
                                        <input type="color" id="backgroundColor" value="#ffffff" class="w-12 h-10 border border-gray-300 rounded">
                                        <input type="text" id="backgroundColorText" value="#ffffff" class="flex-1 p-2 border border-gray-300 rounded focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Generate Button -->
                <button id="generateBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-8 py-3 rounded transition-colors">
                    üèóÔ∏è Generate QR Code
                </button>
            </div>

            <!-- Quick Templates -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Templates</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    <button class="template-btn p-3 border border-gray-300 rounded hover:bg-gray-50 text-left transition-colors" data-template="url">
                        <div class="font-medium text-indigo-700">üåê Website URL</div>
                        <div class="text-sm text-gray-600">https://example.com</div>
                    </button>
                    <button class="template-btn p-3 border border-gray-300 rounded hover:bg-gray-50 text-left transition-colors" data-template="email">
                        <div class="font-medium text-indigo-700">üìß Email</div>
                        <div class="text-sm text-gray-600">mailto:someone@example.com</div>
                    </button>
                    <button class="template-btn p-3 border border-gray-300 rounded hover:bg-gray-50 text-left transition-colors" data-template="phone">
                        <div class="font-medium text-indigo-700">üìû Phone</div>
                        <div class="text-sm text-gray-600">tel:+1234567890</div>
                    </button>
                    <button class="template-btn p-3 border border-gray-300 rounded hover:bg-gray-50 text-left transition-colors" data-template="wifi">
                        <div class="font-medium text-indigo-700">üì∂ WiFi</div>
                        <div class="text-sm text-gray-600">WIFI:T:WPA;S:MyNetwork;P:password;;</div>
                    </button>
                </div>
            </div>

            <!-- QR Code Result -->
            <div id="qrResult" class="bg-white rounded-lg shadow-lg p-6 hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Generated QR Code</h3>
                <div class="text-center">
                    <div id="qrCodeContainer" class="qr-preview mb-4">
                        <!-- QR code will be generated here -->
                    </div>
                    <div class="space-x-4">
                        <button id="downloadQR" class="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg shadow-md transition-all duration-200 hover:shadow-lg font-medium">
                            üì• Download QR Code
                        </button>
                        <button id="copyQR" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg shadow-md transition-all duration-200 hover:shadow-lg font-medium">
                            üìã Copy to Clipboard
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Read QR Code Section -->
        <div id="readSection" class="hidden space-y-8">
            <!-- Upload Section -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Read QR Code from Image</h2>
                
                <!-- Notice about QR scanning -->
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-4">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <svg class="w-5 h-5 text-blue-600 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <div class="ml-3">
                            <h4 class="text-sm font-medium text-blue-800">QR Code Reading</h4>
                            <p class="text-sm text-blue-700 mt-1">Our QR code generator creates visual QR codes that are perfect for sharing and downloading. The QR reading feature is currently optimized for testing our generated codes. For the most reliable QR code scanning, we recommend using your phone's camera or a dedicated QR scanner app.</p>
                            <p class="text-sm text-blue-700 mt-2"><strong>Generated QR codes work great with:</strong> Phone cameras, QR scanner apps, and external QR readers.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Drop Zone -->
                <div id="qrDropZone" class="drop-zone rounded-lg p-8 text-center mb-4">
                    <div class="mb-4">
                        <svg class="w-12 h-12 mx-auto text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                        </svg>
                    </div>
                    <p class="text-gray-600 mb-2">Drag and drop an image with QR code here</p>
                    <p class="text-sm text-gray-500 mb-4">or</p>
                    <input type="file" id="qrFileInput" accept="image/*" class="hidden">
                    <label for="qrFileInput" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded cursor-pointer transition-colors">
                        Choose Image File
                    </label>
                </div>

                <!-- Camera Option -->
                <div class="text-center">
                    <p class="text-sm text-gray-500 mb-4">or use your camera</p>
                    <button id="cameraBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded transition-colors">
                        üì∏ Use Camera
                    </button>
                </div>
            </div>

            <!-- Camera Section -->
            <div id="cameraSection" class="bg-white rounded-lg shadow-lg p-6 hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Camera QR Scanner</h3>
                <div class="text-center">
                    <video id="cameraVideo" class="max-w-full h-auto border rounded mb-4" autoplay></video>
                    <div class="space-x-4">
                        <button id="captureBtn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded transition-colors">
                            üì∑ Capture & Scan
                        </button>
                        <button id="stopCameraBtn" class="bg-gray-600 hover:bg-gray-700 text-white px-6 py-2 rounded transition-colors">
                            ‚èπÔ∏è Stop Camera
                        </button>
                    </div>
                </div>
            </div>

            <!-- QR Read Result -->
            <div id="qrReadResult" class="bg-white rounded-lg shadow-lg p-6 hidden">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">QR Code Content</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <h4 class="font-medium text-gray-700 mb-2">Uploaded Image</h4>
                        <img id="uploadedImage" src="" alt="Uploaded QR Code" class="w-full h-auto border rounded">
                    </div>
                    <div>
                        <h4 class="font-medium text-gray-700 mb-2">Decoded Content</h4>
                        <div class="bg-gray-50 p-4 rounded border">
                            <textarea id="decodedText" readonly class="w-full h-32 p-2 bg-transparent border-none resize-none focus:outline-none"></textarea>
                        </div>
                        <div class="mt-4 space-x-2">
                            <button id="copyDecoded" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded text-sm transition-colors">
                                üìã Copy Text
                            </button>
                            <button id="openLink" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded text-sm transition-colors hidden">
                                üîó Open Link
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Info Section -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h3 class="text-lg font-semibold text-gray-800 mb-3">üîí Privacy & Security</h3>
            <ul class="text-gray-600 space-y-2">
                <li>‚Ä¢ All QR code generation and reading happens in your browser</li>
                <li>‚Ä¢ No data is sent to any server</li>
                <li>‚Ä¢ Camera access is only used locally for scanning</li>
                <li>‚Ä¢ Perfect for sensitive information</li>
            </ul>
        </div>
    </main>

    <!-- Footer -->
    <footer class="gradient-bg text-white py-4 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm opacity-75">If this tool saved your time, consider supporting ‚ù§Ô∏è</p>
        </div>
    </footer>

    <!-- Floating Support Button -->
    <button id="supportBtn" class="floating-btn bg-yellow-500 hover:bg-yellow-600 text-white p-3 rounded-full shadow-lg transition-colors">
        ‚òï Support
    </button>

    <!-- Support Modal -->
    <div id="supportModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-lg p-6 max-w-md w-full">
            <div class="text-center">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Support This Project</h3>
                <p class="text-gray-600 mb-6">Help keep these tools free and improve them with your support!</p>
                <div class="space-y-3">
                    <a href="https://saweria.co/ahmad25kamel" target="_blank" class="block w-full bg-green-500 hover:bg-green-600 text-white py-3 px-4 rounded font-medium transition-colors">
                        üéÅ Saweria (Indonesia)
                    </a>
                    <a href="https://github.com/sponsors/ahmad25kamel" target="_blank" class="block w-full bg-gray-800 hover:bg-gray-900 text-white py-3 px-4 rounded font-medium transition-colors">
                        ‚ù§Ô∏è GitHub Sponsors
                    </a>
                </div>
                <button id="closeSupportModal" class="mt-4 text-gray-500 hover:text-gray-700 text-sm">Close</button>
            </div>
        </div>
    </div>

    <script>
        // Elements
        const generateTab = document.getElementById('generateTab');
        const readTab = document.getElementById('readTab');
        const generateSection = document.getElementById('generateSection');
        const readSection = document.getElementById('readSection');
        const qrText = document.getElementById('qrText');
        const qrSize = document.getElementById('qrSize');
        const errorCorrection = document.getElementById('errorCorrection');
        const qrFormat = document.getElementById('qrFormat');
        const foregroundColor = document.getElementById('foregroundColor');
        const backgroundColor = document.getElementById('backgroundColor');
        const foregroundColorText = document.getElementById('foregroundColorText');
        const backgroundColorText = document.getElementById('backgroundColorText');
        const generateBtn = document.getElementById('generateBtn');
        const qrResult = document.getElementById('qrResult');
        const qrCodeContainer = document.getElementById('qrCodeContainer');
        const downloadQR = document.getElementById('downloadQR');
        const copyQR = document.getElementById('copyQR');
        const qrDropZone = document.getElementById('qrDropZone');
        const qrFileInput = document.getElementById('qrFileInput');
        const cameraBtn = document.getElementById('cameraBtn');
        const cameraSection = document.getElementById('cameraSection');
        const cameraVideo = document.getElementById('cameraVideo');
        const captureBtn = document.getElementById('captureBtn');
        const stopCameraBtn = document.getElementById('stopCameraBtn');
        const qrReadResult = document.getElementById('qrReadResult');
        const uploadedImage = document.getElementById('uploadedImage');
        const decodedText = document.getElementById('decodedText');
        const copyDecoded = document.getElementById('copyDecoded');
        const openLink = document.getElementById('openLink');
        const toggleAdvanced = document.getElementById('toggleAdvanced');
        const advancedSettings = document.getElementById('advancedSettings');

        let currentStream = null;
        let generatedQRDataUrl = null;

        // Notification System
        function showNotification(message, type = 'info', duration = 5000) {
            const container = document.getElementById('notificationContainer');
            
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            const icons = {
                success: '‚úì',
                error: '‚úï',
                warning: '‚ö†',
                info: '‚Ñπ'
            };
            
            const titles = {
                success: 'Success',
                error: 'Error',
                warning: 'Warning',
                info: 'Info'
            };
            
            notification.innerHTML = `
                <div class="notification-title">
                    <span style="margin-right: 8px;">${icons[type]}</span>
                    ${titles[type]}
                </div>
                <div class="notification-message">${message}</div>
            `;
            
            container.appendChild(notification);
            
            // Trigger show animation
            setTimeout(() => notification.classList.add('show'), 100);
            
            // Auto remove
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, duration);
        }

        // Input validation functions
        function validateQRInput(text) {
            const validationResults = {
                isValid: true,
                type: 'text',
                suggestions: []
            };

            // URL validation
            if (text.startsWith('http://') || text.startsWith('https://')) {
                validationResults.type = 'url';
                try {
                    new URL(text);
                } catch (e) {
                    validationResults.isValid = false;
                    validationResults.suggestions.push('URL format appears invalid. Please check the URL.');
                }
            }
            // Email validation
            else if (text.startsWith('mailto:')) {
                validationResults.type = 'email';
                const emailPattern = /^mailto:[^\s@]+@[^\s@]+\.[^\s@]+/;
                if (!emailPattern.test(text)) {
                    validationResults.suggestions.push('Email format may be incorrect.');
                }
            }
            // Phone validation
            else if (text.startsWith('tel:')) {
                validationResults.type = 'phone';
                if (text.length < 8) {
                    validationResults.suggestions.push('Phone number appears too short.');
                }
            }
            // WiFi validation
            else if (text.startsWith('WIFI:')) {
                validationResults.type = 'wifi';
                if (!text.includes('S:') || !text.includes('T:')) {
                    validationResults.suggestions.push('WiFi QR format may be incomplete. Include network name (S:) and security type (T:).');
                }
            }
            // General text validation
            else {
                if (text.length > 300) {
                    validationResults.suggestions.push('Long text works better with SVG format and higher error correction.');
                }
            }

            return validationResults;
        }

        function optimizeQRSettings(text, currentOptions) {
            const validation = validateQRInput(text);
            const optimizedOptions = { ...currentOptions };

            // Optimize based on content type and length
            if (text.length > 200) {
                optimizedOptions.errorCorrectionLevel = 'L'; // Use low error correction for long text
            } else if (text.length > 100) {
                optimizedOptions.errorCorrectionLevel = 'M'; // Use medium for medium text
            }

            // Size recommendations
            if (text.length > 500) {
                if (parseInt(optimizedOptions.width) < 300) {
                    optimizedOptions.width = 300;
                    optimizedOptions.height = 300;
                }
            }

            return optimizedOptions;
        }
        toggleAdvanced.addEventListener('click', function() {
            const isHidden = advancedSettings.classList.contains('hidden');
            if (isHidden) {
                advancedSettings.classList.remove('hidden');
                this.innerHTML = 'üîº Hide Advanced Settings';
            } else {
                advancedSettings.classList.add('hidden');
                this.innerHTML = '‚öôÔ∏è Advanced Settings';
            }
        });

        // Tab switching
        generateTab.addEventListener('click', function() {
            switchTab('generate');
        });

        readTab.addEventListener('click', function() {
            switchTab('read');
        });

        function switchTab(tab) {
            if (tab === 'generate') {
                generateTab.classList.add('active');
                readTab.classList.remove('active');
                generateSection.classList.remove('hidden');
                readSection.classList.add('hidden');
            } else {
                readTab.classList.add('active');
                generateTab.classList.remove('active');
                readSection.classList.remove('hidden');
                generateSection.classList.add('hidden');
            }
        }

        // Color pickers sync
        foregroundColor.addEventListener('change', function() {
            foregroundColorText.value = this.value;
        });

        backgroundColor.addEventListener('change', function() {
            backgroundColorText.value = this.value;
        });

        foregroundColorText.addEventListener('change', function() {
            foregroundColor.value = this.value;
        });

        backgroundColorText.addEventListener('change', function() {
            backgroundColor.value = this.value;
        });

        // Template buttons
        document.querySelectorAll('.template-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const template = this.dataset.template;
                switch (template) {
                    case 'url':
                        qrText.value = 'https://example.com';
                        break;
                    case 'email':
                        qrText.value = 'mailto:someone@example.com?subject=Hello&body=Your message here';
                        break;
                    case 'phone':
                        qrText.value = 'tel:+1234567890';
                        break;
                    case 'wifi':
                        qrText.value = 'WIFI:T:WPA;S:MyNetwork;P:password;;';
                        break;
                }
            });
        });

        // Generate QR Code with improved error handling
        generateBtn.addEventListener('click', function() {
            const text = qrText.value.trim();
            if (!text) {
                showNotification('Please enter some text to generate QR code.', 'warning');
                return;
            }

            // Validate input
            const validation = validateQRInput(text);
            if (validation.suggestions.length > 0) {
                showNotification(`Tip: ${validation.suggestions[0]}`, 'info', 7000);
            }

            // Validate input length
            if (text.length > 2000) {
                showNotification('Text is too long. Please keep it under 2000 characters for best results.', 'warning');
                return;
            }

            // Show loading state
            generateBtn.disabled = true;
            generateBtn.innerHTML = '‚è≥ Generating...';
            qrCodeContainer.innerHTML = '<div class="text-center py-4"><div class="animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600 mx-auto"></div><p class="text-sm text-gray-600 mt-2">Generating QR code...</p></div>';

            let options = {
                width: parseInt(qrSize.value),
                height: parseInt(qrSize.value),
                errorCorrectionLevel: errorCorrection.value,
                color: {
                    dark: foregroundColor.value,
                    light: backgroundColor.value
                }
            };

            // Optimize settings based on content
            options = optimizeQRSettings(text, options);

            // Helper function to handle errors with fallback
            const handleQRError = (err, retryCallback) => {
                console.warn('QR generation error:', err);
                
                // Check if error is related to high error correction levels
                if (err.message && err.message.includes('bad rs block')) {
                    if (options.errorCorrectionLevel === 'H' || options.errorCorrectionLevel === 'Q') {
                        showNotification('High error correction failed. Trying with medium error correction...', 'info');
                        options.errorCorrectionLevel = 'M';
                        setTimeout(retryCallback, 500);
                        return;
                    } else if (options.errorCorrectionLevel === 'M') {
                        showNotification('Medium error correction failed. Trying with low error correction...', 'info');
                        options.errorCorrectionLevel = 'L';
                        setTimeout(retryCallback, 500);
                        return;
                    }
                }
                
                // Final fallback - show user-friendly error
                generateBtn.disabled = false;
                generateBtn.innerHTML = 'üèóÔ∏è Generate QR Code';
                qrCodeContainer.innerHTML = '';
                
                let errorMessage = 'Unable to generate QR code. ';
                if (text.length > 100) {
                    errorMessage += 'Try with shorter text or switch to SVG format.';
                } else {
                    errorMessage += 'Please try again or contact support if the issue persists.';
                }
                
                showNotification(errorMessage, 'error');
            };

            const generateSVG = () => {
                QRCode.toString(text, {
                    ...options,
                    type: 'svg'
                }, function(err, string) {
                    if (err) {
                        handleQRError(err, generateSVG);
                        return;
                    }
                    
                    qrCodeContainer.innerHTML = string;
                    generatedQRDataUrl = 'data:image/svg+xml;base64,' + btoa(string);
                    qrResult.classList.remove('hidden');
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = 'üèóÔ∏è Generate QR Code';
                    showNotification('QR code generated successfully!', 'success');
                });
            };

            const generateCanvas = () => {
                QRCode.toCanvas(text, options, function(err, canvas) {
                    if (err) {
                        handleQRError(err, generateCanvas);
                        return;
                    }
                    
                    qrCodeContainer.innerHTML = '';
                    qrCodeContainer.appendChild(canvas);
                    generatedQRDataUrl = canvas.toDataURL('image/png');
                    qrResult.classList.remove('hidden');
                    generateBtn.disabled = false;
                    generateBtn.innerHTML = 'üèóÔ∏è Generate QR Code';
                    showNotification('QR code generated successfully!', 'success');
                });
            };

            // Execute generation based on format
            if (qrFormat.value === 'svg') {
                generateSVG();
            } else {
                generateCanvas();
            }
        });

        // Download QR Code
        downloadQR.addEventListener('click', function() {
            if (!generatedQRDataUrl) return;

            const link = document.createElement('a');
            link.href = generatedQRDataUrl;
            link.download = `qr-code.${qrFormat.value}`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });

        // Copy QR Code to clipboard
        copyQR.addEventListener('click', async function() {
            if (!generatedQRDataUrl) {
                showNotification('No QR code to copy. Please generate one first.', 'warning');
                return;
            }

            try {
                const response = await fetch(generatedQRDataUrl);
                const blob = await response.blob();
                await navigator.clipboard.write([
                    new ClipboardItem({ [blob.type]: blob })
                ]);
                showNotification('QR code copied to clipboard successfully!', 'success');
            } catch (err) {
                console.error('Failed to copy QR code: ', err);
                // Fallback for browsers that don't support clipboard API
                showNotification('Copy to clipboard not supported. Try using the download button instead.', 'warning');
            }
        });

        // QR Code Reading - Drag and Drop
        qrDropZone.addEventListener('dragover', function(e) {
            e.preventDefault();
            qrDropZone.classList.add('dragover');
        });

        qrDropZone.addEventListener('dragleave', function(e) {
            e.preventDefault();
            qrDropZone.classList.remove('dragover');
        });

        qrDropZone.addEventListener('drop', function(e) {
            e.preventDefault();
            qrDropZone.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0 && files[0].type.startsWith('image/')) {
                readQRFromFile(files[0]);
            }
        });

        // File input for QR reading
        qrFileInput.addEventListener('change', function(e) {
            if (e.target.files.length > 0) {
                readQRFromFile(e.target.files[0]);
            }
        });

        // Camera functionality
        cameraBtn.addEventListener('click', async function() {
            try {
                currentStream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
                cameraVideo.srcObject = currentStream;
                cameraSection.classList.remove('hidden');
            } catch (err) {
                console.error('Error accessing camera:', err);
                alert('Error accessing camera. Please make sure you have granted camera permissions.');
            }
        });

        captureBtn.addEventListener('click', function() {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = cameraVideo.videoWidth;
            canvas.height = cameraVideo.videoHeight;
            context.drawImage(cameraVideo, 0, 0);
            
            const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
            const code = jsQR(imageData.data, imageData.width, imageData.height);
            
            if (code) {
                displayQRResult(code.data, canvas.toDataURL());
                stopCamera();
            } else {
                alert('No QR code found in the camera view. Please:\n‚Ä¢ Make sure the QR code is clearly visible\n‚Ä¢ Move closer or adjust lighting\n‚Ä¢ Ensure the QR code fills a good portion of the camera view\n\nThis decoder works best with simple QR codes.');
            }
        });

        stopCameraBtn.addEventListener('click', stopCamera);

        function stopCamera() {
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
                cameraSection.classList.add('hidden');
            }
        }

        // Read QR from file
        function readQRFromFile(file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const context = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    context.drawImage(img, 0, 0);
                    
                    const imageData = context.getImageData(0, 0, canvas.width, canvas.height);
                    const code = jsQR(imageData.data, imageData.width, imageData.height);
                    
                    if (code) {
                        displayQRResult(code.data, e.target.result);
                    } else {
                        // Provide more helpful error message
                        alert('No QR code found in the image. Please ensure:\n‚Ä¢ The image contains a clear QR code\n‚Ä¢ The QR code is not rotated or distorted\n‚Ä¢ There is good contrast between the QR code and background\n\nThis tool works best with QR codes generated by the same application.');
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Display QR reading result
        function displayQRResult(text, imageUrl) {
            uploadedImage.src = imageUrl;
            decodedText.value = text;
            
            // Check if it's a URL
            if (text.startsWith('http://') || text.startsWith('https://')) {
                openLink.classList.remove('hidden');
                openLink.onclick = function() {
                    window.open(text, '_blank');
                };
            } else {
                openLink.classList.add('hidden');
            }
            
            qrReadResult.classList.remove('hidden');
        }

        // Copy decoded text
        copyDecoded.addEventListener('click', async function() {
            try {
                await navigator.clipboard.writeText(decodedText.value);
                alert('Text copied to clipboard!');
            } catch (err) {
                console.error('Failed to copy text: ', err);
                alert('Failed to copy text to clipboard.');
            }
        });

        // Support modal functionality
        const supportBtn = document.getElementById('supportBtn');
        const supportModal = document.getElementById('supportModal');
        const closeSupportModal = document.getElementById('closeSupportModal');

        supportBtn.addEventListener('click', function() {
            supportModal.classList.remove('hidden');
        });

        closeSupportModal.addEventListener('click', function() {
            supportModal.classList.add('hidden');
        });

        // Close modal when clicking outside
        supportModal.addEventListener('click', function(e) {
            if (e.target === supportModal) {
                supportModal.classList.add('hidden');
            }
        });
    </script>
</body>
</html>